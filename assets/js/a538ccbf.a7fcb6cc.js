"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[250],{6165:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>o,default:()=>c,frontMatter:()=>r,metadata:()=>a,toc:()=>h});var s=n(4848),i=n(8453);const r={title:"Monitoring and Operations",sidebar_position:5},o=void 0,a={id:"monitoring-and-operations",title:"Monitoring and Operations",description:"[//]: # (Copyright Jiaqi Liu)",source:"@site/docs/monitoring-and-operations.md",sourceDirName:".",slug:"/monitoring-and-operations",permalink:"/athena/docs/monitoring-and-operations",draft:!1,unlisted:!1,editUrl:"https://github.com/QubitPi/athena/tree/master/docs/docs/monitoring-and-operations.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{title:"Monitoring and Operations",sidebar_position:5},sidebar:"docSidebar",previous:{title:"System Configuration",permalink:"/athena/docs/system-config"},next:{title:"Logging Guidelines",permalink:"/athena/docs/logging-guidelines"}},d={},h=[{value:"Logs",id:"logs",level:2},{value:"Request Log",id:"request-log",level:3},{value:"Metrics",id:"metrics",level:2},{value:"Health Checks",id:"health-checks",level:2}];function l(e){const t={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.p,{children:"Athena was built from the start to be easy to operate and debug. There are 3 primary ways in which Athena makes\ndebugging and gathering information about how it's running easy."}),"\n",(0,s.jsx)(t.h2,{id:"logs",children:"Logs"}),"\n",(0,s.jsxs)(t.p,{children:["Athena has ",(0,s.jsx)(t.a,{href:"logging-guidelines",children:"strict guidelines"})," around\nwhat information should be logged, when it should be logged, and what level it should be logged at. Here's a brief\nsummary of the log levels and what they contain:"]}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Level"}),(0,s.jsx)(t.th,{children:"Meaning"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Error"}),(0,s.jsx)(t.td,{children:'System-caused problem preventing correct results for requests. Major, "wake up a human" events.'})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Warn"}),(0,s.jsx)(t.td,{children:"Something's wrong, like no caching, but can still correctly respond to requests. A human should investigate."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Info"}),(0,s.jsx)(t.td,{children:'Working as expected. Information needed for monitoring. Answers "Are things healthy."'})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Debug"}),(0,s.jsx)(t.td,{children:"High-level data flow and errors. Rich insight, but not overwhelming. Per-request errors, but not happy-path."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Trace"}),(0,s.jsx)(t.td,{children:"Most verbose. Full data flow. Not intended to be used in production, or very rarely."})]})]})]}),"\n",(0,s.jsx)(t.h3,{id:"request-log",children:"Request Log"}),"\n",(0,s.jsxs)(t.p,{children:["Athena also has a tracing mechanism that records and collects information about each request as it flows through the\nsystem. This information is called the ",(0,s.jsx)(t.strong,{children:"Request Log"})," and it gets logged at the ",(0,s.jsx)(t.a,{href:"logging-guidelines#Info",children:"INFO"})," level\nwhen the response for a request is sent."]}),"\n",(0,s.jsxs)(t.p,{children:["The Request Log is modular, and has a number of different components, depending on which type of request is being\nserved. All Request Logs contain a Durations, Threads, and Preface component at the beginning, an Epilogue component at\nthe end, and other components that are added as requests are processed will get added in between in the order they are\nadded. If desired, this ordering can be controlled by setting the ",(0,s.jsx)(t.code,{children:"requestlog_loginfo_order"})," property."]}),"\n",(0,s.jsxs)(t.p,{children:["As part of the Request Log tracing, each request is assigned a UUID that which shows up in the INFO line for Request Log\nlog lines. This UUID is also made available on ",(0,s.jsx)(t.em,{children:"every"})," log line via ",(0,s.jsx)(t.a,{href:"http://www.slf4j.org/api/org/slf4j/MDC.html",children:"MDC"}),"\nunder the key ",(0,s.jsx)(t.code,{children:"logid"})," so that all log lines emitted while processing a request can be easily collected together. To\nsurface this UUID in all log lines emitted while processing a request, your log format needs to include a reference to\nthe UUID value in MDC. Here are some examples for common logging frameworks:"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.a,{href:"http://logback.qos.ch/manual/layouts.html#mdc",children:"Logback"})}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"%mdc{logid:-unset}\n%X{logid:-unset}\n"})}),"\n",(0,s.jsxs)(t.p,{children:["Note that the ",(0,s.jsx)(t.code,{children:"-unset"})," sets the default value to ",(0,s.jsx)(t.code,{children:"unset"})," if there is no ",(0,s.jsx)(t.code,{children:"logid"})," value present in MDC, which is possible\nfor logs emitted outside of processing a request, like background processes."]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.a,{href:"https://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/PatternLayout.html",children:"Log4J"})}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"%X{logid}\n"})}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.a,{href:"https://logging.apache.org/log4j/2.x/manual/layouts.html",children:"Log4J2"})}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"%X{logid}\n%mdc{logid}\n%MDC{logid}\n"})}),"\n",(0,s.jsx)(t.h2,{id:"metrics",children:"Metrics"}),"\n",(0,s.jsxs)(t.p,{children:["Athena uses the ",(0,s.jsx)(t.a,{href:"http://metrics.dropwizard.io/",children:"Metrics"})," library (formerly Dropwizard Metrics) for gathering and\nreporting on runtime metrics and indicators. Typically, these are exposed through an admin servlet, and if that's\nenabled then there is ",(0,s.jsx)(t.a,{href:"kpi",children:"a list of Key Performance Indicators (KPIs)"})," that are exposed through the ",(0,s.jsx)(t.code,{children:"/metrics"}),"\nendpoint. The KPI document doesn't go into detail about what each of the KPIs mean, but it gives a rough overview of why\nthey matter."]}),"\n",(0,s.jsx)(t.h2,{id:"health-checks",children:"Health Checks"}),"\n",(0,s.jsxs)(t.p,{children:["Athena also uses the Metrics library for implementing health checks. These are also exposed through the admin servlet,\njust like metrics, at ",(0,s.jsx)(t.code,{children:"/status"}),". Each of the health checks has a message and a status, and if any of the checks fail,\nthe HTTP Status Code for that ",(0,s.jsx)(t.code,{children:"/status"})," request will be a 500 instead of a 200 to indicate the system is unhealthy."]}),"\n",(0,s.jsxs)(t.p,{children:["These health checks are also used to gate ",(0,s.jsx)(t.code,{children:"/file"})," and ",(0,s.jsx)(t.code,{children:"/metadata"})," requests, with Athena returning\n",(0,s.jsx)(t.code,{children:"503 Service Unavailable"})," if it doesn't think it is healthy."]})]})}function c(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>a});var s=n(6540);const i={},r=s.createContext(i);function o(e){const t=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(r.Provider,{value:t},e.children)}}}]);